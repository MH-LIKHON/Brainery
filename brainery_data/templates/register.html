{% extends "base.html" %}

{% block content %}

<!-- CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

<!-- Flash Messages -->
{% if not show_success %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="flash-messages">
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}
{% endif %}

<!-- Error Message Container -->
<div id="error-container" style="display: none; text-align: center; color: red; font-size: 1.2em; margin-bottom: 20px;">
</div>


<!-- Show Registration Form Only if Not Success -->
{% if not show_success %}
<div class="register-container" id="register-form">

    <h2>Choose Your Brainery Plan</h2>

    <!-- Package Selection -->
    <div class="package-selection">
        <div class="package" data-price="10" data-name="Weekly Plan">
            <h4>Weekly Plan - Â£10</h4>
            <ul>
                <li>ðŸ“š Access to all courses</li>
                <li>ðŸ—“ 7-day validity</li>
                <li>ðŸ’¬ Community Support</li>
            </ul>
        </div>
        <div class="package" data-price="30" data-name="Monthly Plan">
            <h4>Monthly Plan - Â£30</h4>
            <ul>
                <li>ðŸ“š Access to all courses</li>
                <li>ðŸ—“ 30-day validity</li>
                <li>ðŸ’¬ Priority Support</li>
            </ul>
        </div>
        <div class="package" data-price="100" data-name="Annual Plan">
            <h4>Annual Plan - Â£100</h4>
            <ul>
                <li>ðŸ“š Access to all courses</li>
                <li>ðŸ—“ 1-year validity</li>
                <li>ðŸŽ“ Certification on Completion</li>
            </ul>
        </div>
    </div>

    <!-- Multi-Step Registration Form -->
    <form method="POST" id="registration-form">

        <!-- CSRF Token -->
        {{ form.hidden_tag() }}

        <input type="hidden" id="selected_plan" name="selected_plan" required>

        <!-- Step 1: Personal Info -->
        <div id="personal-info" class="step-section">
            <h4>Tell us about yourself</h4>

            <div class="form-group">
                <label for="first_name">First Name</label>
                {{ form.first_name(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="last_name">Last Name</label>
                {{ form.last_name(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="dob">Date of Birth</label>
                {{ form.dob(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="email">Email Address</label>
                {{ form.email(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="phone">Phone Number</label>
                {{ form.phone(class="form-control", required=True) }}
            </div>

            <h5>Billing Address</h5>
            <div class="form-group">
                <label for="address_line1">Address Line 1</label>
                {{ form.address_line1(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="city">City</label>
                {{ form.city(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="country">Country</label>
                {{ form.country(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="postcode">Postcode</label>
                {{ form.postcode(class="form-control", required=True) }}
            </div>

            <button type="button" class="next-btn" onclick="nextStep('personal-info', 'payment-info')">Next</button>
        </div>

        <!-- Step 2: Payment Info -->
        <div id="payment-info" class="step-section hidden">
            <h4>Enter Payment Details</h4>

            <div class="form-group">
                <label for="card_number">Card Number</label>
                <input type="text" name="card_number" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="expiry_date">Expiry Date</label>
                <input type="text" name="expiry_date" class="form-control" placeholder="MM/YY" required>
            </div>
            <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" name="cvv" class="form-control" required>
            </div>

            <div class="form-group promo-code">
                <label for="promo-code">Promo Code (Optional)</label>
                <input type="text" id="promo-code" class="form-control" placeholder="Enter promo code">
                <button type="button" onclick="applyPromoCode()">Apply</button>
                <p id="promo-message"></p>
            </div>

            <button type="button" class="next-btn" onclick="nextStep('payment-info', 'password-info')">Next</button>
        </div>

        <!-- Step 3: Password Info -->
        <div id="password-info" class="step-section hidden">
            <h4>Set Your Account Password</h4>
            <div class="form-group">
                <label for="password">Password</label>
                {{ form.password(class="form-control", required=True) }}
            </div>
            <div class="form-group">
                <label for="confirm_password">Confirm Password</label>
                {{ form.confirm_password(class="form-control", required=True) }}
            </div>

            <button type="submit" class="submit-btn">Complete Registration</button>
        </div>
    </form>
</div>
{% endif %}

<!-- Funny Success Message (Shows Only After Success) -->
{% if show_success %}
<div class="success-message show" id="success-message"
    style="text-align: center; margin: auto; max-width: 600px; padding: 20px;">
    <h2>ðŸŽ‰ Woohoo! Youâ€™re now officially part of the Brainery Family! ðŸŽ“</h2>
    <p>ðŸ“¬ Check your email for your account activation link.</p>
    <p>ðŸ¤– If you donâ€™t see it, maybe itâ€™s lost in the <strong>Matrix</strong> (or spam folder).</p>
    <p>ðŸš€ Happy Learning!</p>
</div>
{% endif %}

<!-- JavaScript -->
<script src="{{ url_for('static', filename='js/register.js') }}"></script>

{% endblock %}